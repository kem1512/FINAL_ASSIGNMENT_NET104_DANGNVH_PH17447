@model List<HoaDon>
@{
    ViewData["Title"] = "Quản lý hóa đơn";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row mt-3">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <div class="card-title">
                    <h5>Quản lý hóa đơn</h5>
                </div>

                <!-- Row to hold the form for searching, filtering by date and status -->
                <div class="row mb-3">
                    <div class="col-lg-12">
                        <form class="form-inline" method="get" action="@Url.Action("Index")" id="searchForm">
                            <div class="form-row w-100">
                                <!-- Input for invoice code or customer name -->
                                <div class="col-md-3 mb-2">
                                    <input type="text" class="form-control w-100" name="input" placeholder="Nhập mã hóa đơn hoặc tên khách hàng" value="@ViewContext.HttpContext.Request.Query["input"]">
                                </div>

                                <!-- Date range filters -->
                                <div class="col-md-3 mb-2">
                                    <input type="date" class="form-control w-100" name="startDate" value="@ViewContext.HttpContext.Request.Query["startDate"]">
                                </div>

                                <div class="col-md-3 mb-2">
                                    <input type="date" class="form-control w-100" name="endDate" value="@ViewContext.HttpContext.Request.Query["endDate"]">
                                </div>

                                <!-- Status filter dropdown -->
                                <div class="col-md-2 mb-2">
                                    <select class="form-control w-100" name="tinhTrang">
                                        <option value="">Tất cả trạng thái</option>
                                        <!option value="1" @(ViewContext.HttpContext.Request.Query["tinhTrang"] == "1" ? "selected" : "")>Hoàn thành</!option>
                                        <!option value="0" @(ViewContext.HttpContext.Request.Query["tinhTrang"] == "0" ? "selected" : "")>Chưa hoàn thành</!option>
                                    </select>
                                </div>

                                <!-- Search and Clear buttons -->
                                <div class="col-md-1 mb-2">
                                    <button type="submit" class="btn btn-primary w-100">Tìm kiếm</button>
                                </div>

                                <!-- Clear button to reset filters -->
                                <div class="col-md-1 mb-2">
                                    <a href="@Url.Action("Index")" class="btn btn-danger w-100">Clear</a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Invoice Table -->
                <div class="table-responsive">
                    <table class="table" id="myTable">
                        <thead>
                        <tr>
                            <th>Mã hóa đơn</th>
                            <th>Tên người nhận</th>
                            <th>Địa chỉ</th>
                            <th>Tổng tiền</th>
                            <th>Trạng thái</th>
                            <th>Ngày tạo</th>
                            <th>Thao tác</th>
                        </tr>
                        </thead>
                        <tbody>
                        @foreach (var x in Model)
                        {
                            <tr>
                                <td>@x.Id</td>
                                <td>@x.TenNguoiNhan</td>
                                <td>@x.DiaChi</td>
                                <td>@Helper.FormatVietNamDong(x.TongTien)</td>
                                <td>@(x.TinhTrang == 0 ? "Chưa hoàn thành" : "Hoàn thành")</td>
                                <td>@x.NgayTao</td>
                                <td>
                                    <a class="btn btn-primary" href="@Url.ActionLink("Detail", "HoaDon", new { x.Id })">Xem chi tiết</a>
                                    @if (x.TinhTrang == 0)
                                    {
                                        <a onclick="return confirm('Bạn có chắc muốn thanh toán?')" class="btn btn-danger" href="@Url.ActionLink("CompleteOrder", "HoaDon", new { x.Id })">Hoàn Thành</a>
                                    }
                                </td>
                            </tr>
                        }
                        </tbody>
                    </table>

                    <!-- Pagination Partial View -->
                    @await Html.PartialAsync("Pagination", new PaginationViewModel
                    {
                        CurrentPageIndex = ViewBag.CurrentPageIndex,
                        PageCount = ViewBag.PageCount,
                        PageName = "HoaDon"
                    })
                </div>
            </div>
        </div>
    </div>
</div>